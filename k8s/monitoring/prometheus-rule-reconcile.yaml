apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: paylink-reconcile-rules
  labels:
    prometheus: k8s
    role: alert-rules
spec:
  groups:
    - name: paylink.rules
      rules:
        - alert: PaylinkReconcileJobFailing
          expr: |
            increase(kube_job_status_failed{job="paylink-reconcile"}[1h]) > 0
          for: 15m
          labels:
            severity: warning
          annotations:
            summary: "Reconciliation CronJob failures detected for paylink"
            description: "The reconciliation CronJob has recorded failures in the past hour. Check Job logs and investigate."
        - alert: PaylinkReconcileHighAttempts
          expr: |
            increase(paylink_reconcile_attempts_total[1h]) > 50
          for: 30m
          labels:
            severity: warning
          annotations:
            summary: "High number of reconciliation attempts"
            description: "A high number of reconciliation attempts indicates the system is not resolving pending transactions."

# Notes:
# - The 'kube_job_status_failed' metric comes from kube-state-metrics; ensure it's available in your Prometheus.
# - 'paylink_reconcile_attempts_total' is an optional custom metric you can emit from the reconciliation job when it increments attempts.
# Adjust expressions to match your monitoring setup.
